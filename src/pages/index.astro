---
import Layout from "../layouts/Layout.astro";
import Card from "../components/card/Card.astro";
import { readJsonFileFromDrive } from "../services/youtube";
import YoutubeButton from "../components/youtubeButton/YoutubeButton.astro";
import styles from "./index.module.scss";

const cardsJsonGoogleDriveId = import.meta.env.GOOGLE_DRIVE_ID;
const { bio, cards } = await readJsonFileFromDrive(cardsJsonGoogleDriveId);
---

<Layout title="Pink Sofa Hour" class={styles.main}>
  <Card>
    <h1
      style="font-family: SignPainter-HouseBrush; letter-spacing: 0.5rem; text-align: center;"
    >
      Pink Sofa Hour
    </h1>
  </Card>

  <div class={styles.introVideo}>
    <iframe
      width="560"
      height="315"
      src="https://www.youtube.com/embed/O50RrxSSbqw"
      title="YouTube video player"
      frameborder="0"
      allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
      allowfullscreen></iframe>
  </div>

  <Card>
    <p>
      {
        bio?.map((e: any) => {
          if (typeof e === "string") return e;
          else if (typeof e.text === "string" && typeof e.href === "string")
            return <a href={e.href}>{e.text}</a>;
        })
      }
    </p>
  </Card>

  <div class={styles.episodeGrid}>
    {
      // TODO fix any type
      cards?.map((card: any) => (
        <Card>
          <img src={`https://drive.google.com/uc?id=${card.photoId}`} />
          <h2>{card.title}</h2>
          {card.description && <p>{card.description}</p>}
          <a target="_blank" href={card.videoUrl}>
            <YoutubeButton />
            <p>Watch on Youtube</p>
          </a>
        </Card>
      ))
    }
  </div>
</Layout>
